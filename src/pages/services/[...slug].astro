---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navigation from '../../components/Navigation';
import ServiceHeroSection from '../../components/ServiceHeroSection.astro';
import ServiceContent from '../../page-components/ServiceContent.tsx';
import CtaBlock from '../../components/CtaBlock.astro';
import Footer from '../../components/Footer';
import { getPublishedServices, getServiceBySlug } from '../../data/services';

export function getStaticPaths() {
  const services = getPublishedServices();
  return services.map((service) => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

const { slug } = Astro.params;
// Handle both single slugs and nested slugs (e.g., "pallet-racking-removal" or "strip-out-solutions/pallet-racking-removal")
const fullSlug = Array.isArray(slug) ? slug.join('/') : slug;
const service = getServiceBySlug(fullSlug);

if (!service) {
  return Astro.redirect('/services/');
}
---

<BaseLayout 
  title={service.metaTitle}
  description={service.metaDescription}
  ogImage={service.ogImage || "/og-default.jpg"}
  canonicalUrl={`https://makegood.melbourne/services/${service.slug}`}
>
  <div class="min-h-screen flex flex-col bg-background">
    <!-- Skip to Content Link for Accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
    >
      Skip to main content
    </a>
    
    <Navigation client:idle />
    
    <main id="main-content" class="flex-1">
      <!-- Static optimized hero section with breadcrumbs -->
      <ServiceHeroSection slug={fullSlug} />
      
      <!-- Interactive content loaded after hero -->
      <ServiceContent slug={fullSlug} client:idle />
      
      <!-- Standardized CTA Block -->
      <CtaBlock />
    </main>
    
    <Footer client:idle />
  </div>
</BaseLayout>
