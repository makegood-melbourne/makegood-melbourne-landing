---
import { Image } from 'astro:assets';
import { getServiceBySlug } from '@/data/services';
import { resolveImageSrc } from '@/lib/resolveImageSrc';

interface Props {
  slug: string;
}

const { slug } = Astro.props;
const service = getServiceBySlug(slug);

if (!service || service.published !== true) {
  return;
}

// Use the same hero image source as the service data to avoid environment/build mismatches.
const heroImage = service.heroImage as unknown;
const heroImageAlt = service.heroImageAlt || `${service.name} Melbourne - professional commercial services`;

// Title formatting
const titleParts = service.title.includes('Melbourne') 
  ? { main: service.title.replace(' Melbourne', ''), highlight: 'Melbourne' }
  : { main: service.title, highlight: null };
---

<!-- Breadcrumbs -->
<div class="bg-secondary pt-20">
  <div class="container mx-auto px-4">
    <nav aria-label="Breadcrumb" class="py-4 text-sm">
      <ol class="flex items-center flex-wrap gap-2">
        <li>
          <a href="/" class="text-muted-foreground hover:text-primary transition-colors">Home</a>
        </li>
        <li class="text-muted-foreground">/</li>
        <li>
          <a href="/capabilities" class="text-muted-foreground hover:text-primary transition-colors">Services</a>
        </li>
        <li class="text-muted-foreground">/</li>
        <li>
          <span class="text-foreground font-medium">{service.name}</span>
        </li>
      </ol>
    </nav>
  </div>
</div>

<!-- Hero Section -->
<section class="bg-secondary pt-6 pb-10 md:pt-10 md:pb-12">
  <div class="container mx-auto px-4">
    <div class="grid lg:grid-cols-2 gap-12 items-center">
      <div>
        <!-- Title -->
        <h1 class="text-4xl md:text-5xl lg:text-6xl text-foreground mb-6">
          {titleParts.highlight ? (
            <>
              {titleParts.main}{' '}<span class="text-primary">{titleParts.highlight}</span>
            </>
          ) : (
            service.title
          )}
        </h1>
        
        <!-- Hero Image - Mobile only -->
        <div class="lg:hidden mb-6">
          {heroImage ? (
            <Image 
              src={heroImage} 
              alt={heroImageAlt}
              class="aspect-[4/3] w-full object-cover rounded-lg"
              widths={[360, 640, 800]}
              sizes="(max-width: 640px) 360px, (max-width: 1024px) 640px, 800px"
              loading="eager"
              decoding="async"
              quality={70}
            />
          ) : (
            <div class="aspect-[4/3] bg-muted/30 rounded-lg border-2 border-dashed border-muted-foreground/20 flex items-center justify-center">
              <span class="text-muted-foreground/50 text-sm">Service Image</span>
            </div>
          )}
        </div>
        
        <!-- Description -->
        <p class="text-xl text-muted-foreground mb-8">
          {service.heroText}
        </p>
        
        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-4">
          <a href="/#contact" class="inline-flex items-center justify-center h-11 px-8 rounded-md bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-colors">
            Get a Free Quote
          </a>
          <a href="mailto:enquiries@makegood.melbourne" class="inline-flex items-center justify-center h-11 px-8 rounded-md border border-accent text-accent font-medium hover:bg-accent hover:text-accent-foreground transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            Email Us
          </a>
        </div>
      </div>
      
      <!-- Hero Image - Desktop only -->
      <div class="hidden lg:block">
        {heroImage ? (
          <Image 
            src={heroImage} 
            alt={heroImageAlt}
            class="aspect-[4/3] w-full object-cover rounded-lg"
            widths={[640, 800, 1200]}
            sizes="(max-width: 1024px) 640px, (max-width: 1280px) 800px, 1200px"
            loading="eager"
            decoding="async"
            quality={70}
          />
        ) : (
          <div class="aspect-[4/3] bg-muted/30 rounded-lg border-2 border-dashed border-muted-foreground/20 flex items-center justify-center">
            <span class="text-muted-foreground/50 text-sm">Service Image</span>
          </div>
        )}
      </div>
    </div>
    
    <!-- Trust Badges -->
    {service.trustBadges && service.trustBadges.length > 0 && (
      <div class="flex flex-wrap gap-3 mt-10">
        {service.trustBadges.map((badge: string) => (
          <div class="flex items-center gap-2 px-4 py-2 bg-tertiary/10 rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>
            <span class="text-sm font-medium text-tertiary">{badge}</span>
          </div>
        ))}
      </div>
    )}
  </div>
</section>
